BootStrap: docker
From: continuumio/miniconda3


%help

	Run a jupyter notebook Server in a container
	Usually: http://localhost:8888

%label

	Author: M. Blaschek
	Anaconda Python 3 and jupyter notebook

%runscript

    	echo "Starting notebook... $(/opt/conda/bin/jupyter --version)"
     	echo "$(/opt/conda/bin/jupyter --paths)"
	echo "Token: super-secret"
     	exec /opt/conda/bin/jupyter notebook --NotebookApp.allow_origin="*" --no-browser --NotebookApp.token='super-secret' $@

%post

     	# Install jupyter notebook
     	/opt/conda/bin/conda install jupyter numpy matplotlib pandas -y --quiet 
     	# rename Container Kernel:
     	sed -i 's/Python 3/Py3-Sy/' /opt/conda/share/jupyter/kernels/python3/kernel.json
     	apt-get autoremove -y
     	apt-get clean
     
%environment
	# important part otherwise the server will try to access /run/user and fail
	export JUPYTER_RUNTIME_DIR=$PWD/.runtime
	# make sure we use container kernels, otherwise this will be overwritten 
	# by $HOME/.local/share/jupyter/kernels
	export JUPYTER_DATA_DIR=$PWD/.kernels
